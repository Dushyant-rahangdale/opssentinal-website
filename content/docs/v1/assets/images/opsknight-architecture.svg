<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="900" viewBox="0 0 1600 900">
  <defs>
    <style>
      .bg { fill: #ffffff; }
      .title { font: 800 34px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
      .subtitle { font: 500 16px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #334155; }
      .h { font: 700 16px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
      .p { font: 500 13px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #334155; }
      .muted { fill: #64748b; }

      .card { fill: #ffffff; stroke: #e2e8f0; stroke-width: 1.5; rx: 16; }
      .cardHead { fill: #f8fafc; stroke: #e2e8f0; stroke-width: 1.5; rx: 16; }
      .tag { fill: #0f172a; opacity: 0.06; }

      .accent { fill: #10b981; }
      .accentText { fill: #065f46; }
      .accentStroke { stroke: #10b981; }

      .line { stroke: #94a3b8; stroke-width: 2; fill: none; }
      .line2 { stroke: #cbd5e1; stroke-width: 2; fill: none; }

      .chip { fill: #f1f5f9; stroke: #e2e8f0; stroke-width: 1.2; rx: 12; }
      .chipText { font: 600 12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; fill: #0f172a; }
    </style>

    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="6" stdDeviation="10" flood-color="#0f172a" flood-opacity="0.10"/>
    </filter>

    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/>
    </marker>
    <marker id="arrowLight" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#cbd5e1"/>
    </marker>
  </defs>

  <rect class="bg" x="0" y="0" width="1600" height="900"/>

  <!-- Header -->
  <text class="title" x="80" y="80">OpsKnight Architecture (High-Level)</text>
  <text class="subtitle" x="80" y="112">Next.js App Router + internal scheduler + PostgreSQL (Prisma) + multi-channel notifications</text>

  <!-- Deployment chips -->
  <g transform="translate(1040 58)">
    <rect class="chip" x="0" y="0" width="520" height="44" />
    <text class="chipText" x="16" y="28">Deployments:</text>
    <text class="chipText" x="126" y="28">Docker Compose</text>
    <text class="chipText muted" x="246" y="28">•</text>
    <text class="chipText" x="270" y="28">Helm</text>
    <text class="chipText muted" x="322" y="28">•</text>
    <text class="chipText" x="346" y="28">Kustomize</text>
  </g>

  <!-- Left: Clients -->
  <g filter="url(#shadow)">
    <rect class="card" x="80" y="160" width="360" height="480" rx="18"/>
    <rect class="cardHead" x="80" y="160" width="360" height="64" rx="18"/>
    <text class="h" x="110" y="200">Clients</text>

    <rect class="tag" x="110" y="250" width="300" height="54" rx="14"/>
    <text class="h" x="130" y="282">Web App</text>
    <text class="p muted" x="130" y="302">Browser (server + client UI)</text>

    <rect class="tag" x="110" y="320" width="300" height="54" rx="14"/>
    <text class="h" x="130" y="352">Mobile PWA</text>
    <text class="p muted" x="130" y="372">iOS / Android / desktop install</text>

    <rect class="tag" x="110" y="390" width="300" height="54" rx="14"/>
    <text class="h" x="130" y="422">Public Status Page</text>
    <text class="p muted" x="130" y="442">Public read-only audience</text>

    <rect class="tag" x="110" y="460" width="300" height="70" rx="14"/>
    <text class="h" x="130" y="492">API Clients / Integrations</text>
    <text class="p muted" x="130" y="512">Alertmanager, Datadog, CloudWatch...</text>
  </g>

  <!-- Center: Next.js App -->
  <g filter="url(#shadow)">
    <rect class="card" x="500" y="160" width="560" height="480" rx="18"/>
    <rect class="cardHead" x="500" y="160" width="560" height="64" rx="18"/>
    <text class="h" x="530" y="200">OpsKnight Application (Next.js App Router)</text>

    <rect class="tag" x="530" y="250" width="500" height="62" rx="14"/>
    <text class="h" x="552" y="282">UI + Server Actions</text>
    <text class="p muted" x="552" y="302">src/app/(app), src/app/(mobile), src/components</text>

    <rect class="tag" x="530" y="328" width="500" height="62" rx="14"/>
    <text class="h" x="552" y="360">API Routes</text>
    <text class="p muted" x="552" y="380">/api/events, /api/integrations, /api/status-page, /api/auth</text>

    <rect class="tag" x="530" y="406" width="500" height="62" rx="14"/>
    <text class="h" x="552" y="438">Real-time Streams (SSE)</text>
    <text class="p muted" x="552" y="458">/api/events/stream, /api/notifications/stream, /api/widgets/stream</text>

    <rect class="tag" x="530" y="484" width="244" height="124" rx="14"/>
    <text class="h" x="552" y="516">Internal Scheduler</text>
    <text class="p muted" x="552" y="538">DB-backed lock</text>
    <text class="p muted" x="552" y="558">Escalations + retries</text>
    <text class="p muted" x="552" y="578">SLA checks + cleanup</text>

    <rect class="tag" x="786" y="484" width="244" height="124" rx="14"/>
    <text class="h" x="808" y="516">Background Jobs</text>
    <text class="p muted" x="808" y="538">Postgres-backed queue</text>
    <text class="p muted" x="808" y="558">Notifications + tasks</text>
    <text class="p muted" x="808" y="578">Runs inside app runtime</text>
  </g>

  <!-- Right: PostgreSQL -->
  <g filter="url(#shadow)">
    <rect class="card" x="1120" y="160" width="400" height="480" rx="18"/>
    <rect class="cardHead" x="1120" y="160" width="400" height="64" rx="18"/>
    <text class="h" x="1150" y="200">PostgreSQL (Prisma)</text>

    <rect class="tag" x="1150" y="250" width="340" height="54" rx="14"/>
    <text class="h" x="1170" y="282">Core</text>
    <text class="p muted" x="1170" y="302">Users, Teams, Services</text>

    <rect class="tag" x="1150" y="320" width="340" height="54" rx="14"/>
    <text class="h" x="1170" y="352">Incidents</text>
    <text class="p muted" x="1170" y="372">Alerts, Events, Timelines</text>

    <rect class="tag" x="1150" y="390" width="340" height="54" rx="14"/>
    <text class="h" x="1170" y="422">On-call &amp; Escalations</text>
    <text class="p muted" x="1170" y="442">Schedules, Policies, Shifts</text>

    <rect class="tag" x="1150" y="460" width="340" height="54" rx="14"/>
    <text class="h" x="1170" y="492">Notifications</text>
    <text class="p muted" x="1170" y="512">Providers, Web Push subscriptions</text>

    <rect class="tag" x="1150" y="530" width="340" height="78" rx="14"/>
    <text class="h" x="1170" y="562">SLA / Analytics + Jobs</text>
    <text class="p muted" x="1170" y="582">Rollups, snapshots, job queue, scheduler state</text>
  </g>

  <!-- Bottom: outbound -->
  <g filter="url(#shadow)">
    <rect class="card" x="80" y="690" width="1440" height="150" rx="18"/>
    <rect class="cardHead" x="80" y="690" width="1440" height="56" rx="18"/>
    <text class="h" x="110" y="726">Outbound Channels (Notifications + Integrations)</text>

    <g transform="translate(110 764)">
      <rect class="tag" x="0" y="0" width="270" height="56" rx="14"/>
      <text class="h" x="18" y="22">Email</text>
      <text class="p muted" x="18" y="42">Resend / SendGrid / SMTP / SES</text>

      <rect class="tag" x="300" y="0" width="270" height="56" rx="14"/>
      <text class="h" x="318" y="22">SMS / Voice</text>
      <text class="p muted" x="318" y="42">Twilio or AWS SNS</text>

      <rect class="tag" x="600" y="0" width="270" height="56" rx="14"/>
      <text class="h" x="618" y="22">Web Push (PWA)</text>
      <text class="p muted" x="618" y="42">APNs / FCM via Web Push</text>

      <rect class="tag" x="900" y="0" width="240" height="56" rx="14"/>
      <text class="h" x="918" y="22">Slack</text>
      <text class="p muted" x="918" y="42">OAuth + actions</text>

      <rect class="tag" x="1160" y="0" width="240" height="56" rx="14"/>
      <text class="h" x="1178" y="22">Webhooks</text>
      <text class="p muted" x="1178" y="42">Outbound callbacks</text>
    </g>
  </g>

  <!-- Arrows -->
  <path class="line" d="M 440 310 C 480 310, 470 310, 500 310" marker-end="url(#arrow)"/>
  <path class="line" d="M 440 356 C 480 356, 470 356, 500 356" marker-end="url(#arrow)"/>
  <path class="line" d="M 440 430 C 480 430, 470 430, 500 430" marker-end="url(#arrow)"/>
  <path class="line" d="M 440 510 C 480 510, 470 510, 500 510" marker-end="url(#arrow)"/>

  <path class="line" d="M 1060 392 C 1090 392, 1095 392, 1120 392" marker-end="url(#arrow)"/>
  <path class="line" d="M 1060 530 C 1090 530, 1095 530, 1120 530" marker-end="url(#arrow)"/>

  <path class="line2" d="M 780 640 C 780 666, 780 666, 780 690" marker-end="url(#arrowLight)"/>
  <path class="line2" d="M 640 640 C 640 666, 640 666, 640 690" marker-end="url(#arrowLight)"/>
  <path class="line2" d="M 920 640 C 920 666, 920 666, 920 690" marker-end="url(#arrowLight)"/>

  <!-- Legend -->
  <text class="p muted" x="80" y="870">Note: Scheduler + job queue run inside the Next.js runtime (non-edge) and coordinate via DB-backed locks/state.</text>
</svg>
